name: GitHub Actions
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
on:
    push:
      branches:
        - prod
        - stage
        - dev

    pull_request:
      branches:
        - stage  # Only respond to PRs targeting the stage branch
jobs:
    stage_action:
        if: github.ref == 'refs/heads/stage'
        runs-on: ubuntu-latest
        steps:
          - name: Check out code
            uses: actions/checkout@v4
          - name: Run echo
            run: echo "Run echo on stage..."

    run_test:
      name: Run tests
      if: github.ref == 'refs/heads/stage' || github.ref == 'refs/heads/dev'
      runs-on: ubuntu-latest
      steps:
        - name: Check out code
          uses: actions/checkout@v4

        - name: Set up Node.js
          uses: actions/setup-node@v4
          with:
            node-version: '18'

        - name: Install dependencies
          run: npm install
  
        - name: Run Tests
          run: npm test

    add_patch_version:
      name: Increment PATCH semver
      if: github.ref == 'refs/heads/stage' && github.event_name == 'pull_request' && github.event.pull_request.merged == true
      runs-on: ubuntu-latest
      steps:
        - name: Check out code
          uses: actions/checkout@v4
        - name: Install dependencies
          run: npm install
        - name: Generate Release
          uses: cycjimmy/semantic-release-action@v4
          with:
            branch: stage
            extra_plugins: |
              @semantic-release/changelog
              @semantic-release/git
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  
      
    
